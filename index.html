<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Scanner un code-barres avec QuaggaJS v2</title>
  <style>
    #video-container {
      width: 100%;
      max-width: 400px;
      margin: auto;
      position: relative;
    }
    video {
      width: 100%;
      border: 2px solid #333;
    }
    #result {
      text-align: center;
      font-size: 1.2em;
      margin-top: 10px;
    }
    #start-button {
      display: block;
      margin: 20px auto;
      padding: 10px 20px;
      font-size: 1em;
    }
  </style>
</head>
<body>

<h2 style="text-align:center;">Scanner un code-barres</h2>

<div id="video-container">
  <div id="interactive" class="viewport"></div>
</div>

<p id="result">Aucun code détecté</p>

<!-- Bouton pour déclencher le scanner sur mobile -->
<button id="start-button">Démarrer le scanner</button>

<script src="https://unpkg.com/quagga/dist/quagga.min.js"></script>
<script>
  // Vérifie que la caméra est disponible
  if (navigator.mediaDevices && typeof Quagga !== "undefined") {

    const startButton = document.getElementById("start-button");

    startButton.addEventListener("click", function() {
      // Initialise Quagga
      Quagga.init({
        inputStream: {
          name: "Live",
          type: "LiveStream",
          target: document.querySelector("#interactive"),
          constraints: {
            facingMode: "environment"
          }
        },
        decoder: {
          readers: [
            "code_128_reader",
            "ean_reader",
            "ean_8_reader",
            "code_39_reader",
            "upc_reader",
            "upc_e_reader"
          ]
        }
      }, function (err) {
        if (err) {
          console.error(err);
          return;
        }

        Quagga.start();

        // Assurer que la vidéo est muted et playsinline pour mobile
        const video = document.querySelector("#interactive video");
        if (video) {
          video.muted = true;
          video.setAttribute("muted", "");
          video.setAttribute("playsinline", "");
        }

        console.log("Quagga prêt, scanner démarré !");
        // Masquer le bouton après démarrage
        startButton.style.display = "none";
      });

      // Quand un code est détecté
      Quagga.onDetected(function (result) {
        const code = result.codeResult.code;
        document.getElementById("result").textContent = "Code détecté : " + code;
        // Arrêter le scanner après lecture
        Quagga.stop();
      });
    });

  } else {
    alert("Caméra non disponible ou Quagga non chargé");
  }
</script>

</body>
</html>
